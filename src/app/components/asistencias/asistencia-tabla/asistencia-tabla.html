<div class="table-container">
  <table class="admin-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Usuario</th>
        <th>Fecha</th>
        <th>Entrada</th>
        <th>Salida</th>
        <th>Horas Totales</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let asistencia of asistencias; let i = index">
        <td>{{ obtenerIndice(i) }}</td>
        
        <!-- PIPE NATIVO: uppercase -->
        <td>{{ asistencia.nombreCompleto | uppercase }}</td>
        
        <!-- PIPE PERSONALIZADO: fechaFormato -->
        <td>{{ asistencia.fecha | fechaFormato }}</td>
        
        <!-- Mostrar hora o guiÃ³n -->
        <td>{{ asistencia.horaEntrada || '--' }}</td>
        <td>{{ asistencia.horaSalida || '--' }}</td>
        
        <!-- PIPE PERSONALIZADO: horasTrabajadas -->
        <td>{{ asistencia.horaEntrada | horasTrabajadas:asistencia.horaSalida }}</td>
        
        <!-- PIPE PERSONALIZADO: estadoTexto -->
        <td>
          <span class="status" [ngClass]="obtenerClaseEstado(asistencia.estado)">
            {{ asistencia.estado | estadoTexto }}
          </span>
        </td>
        
        <td>
          <!-- ADMIN: ve todos los botones -->
          <ng-container *ngIf="esAdmin">
            <button class="btn-action edit" title="Editar" (click)="editarAsistencia(asistencia)">
              âœï¸
            </button>
            <button class="btn-action delete" title="Eliminar" (click)="eliminarAsistencia(asistencia.id!)">
              ğŸ—‘ï¸
            </button>
            <button class="btn-action view" title="Ver Detalle" (click)="verDetalleAsistencia(asistencia)">
              ğŸ‘ï¸
            </button>
          </ng-container>

          <!-- USUARIO: solo ve detalle -->
          <ng-container *ngIf="!esAdmin">
            <button class="btn-action view" title="Ver Detalle" (click)="verDetalleAsistencia(asistencia)">
              ğŸ‘ï¸ Ver Detalle
            </button>
          </ng-container>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Modal Ver Detalle -->
<div *ngIf="mostrarModalDetalle && asistenciaSeleccionada" class="modal-overlay" (click)="cerrarModalDetalle()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h3>Detalle de Asistencia</h3>
    <div class="detalle-info">
      <div class="info-row">
        <strong>Usuario:</strong>
        <!-- PIPE NATIVO: titlecase -->
        <span>{{ asistenciaSeleccionada.nombreCompleto | titlecase }}</span>
      </div>
      <div class="info-row">
        <strong>Fecha:</strong>
        <!-- PIPE PERSONALIZADO: fechaFormato con formato largo -->
        <span>{{ asistenciaSeleccionada.fecha | fechaFormato:'largo' }}</span>
      </div>
      <div class="info-row">
        <strong>Hora de Entrada:</strong>
        <span>{{ asistenciaSeleccionada.horaEntrada || '--' }}</span>
      </div>
      <div class="info-row">
        <strong>Hora de Salida:</strong>
        <span>{{ asistenciaSeleccionada.horaSalida || '--' }}</span>
      </div>
      <div class="info-row">
        <strong>Horas Totales:</strong>
        <!-- PIPE PERSONALIZADO: horasTrabajadas -->
        <span>{{ asistenciaSeleccionada.horaEntrada | horasTrabajadas:asistenciaSeleccionada.horaSalida }}</span>
      </div>
      <div class="info-row">
        <strong>Estado:</strong>
        <!-- PIPE PERSONALIZADO: estadoTexto -->
        <span class="status" [ngClass]="obtenerClaseEstado(asistenciaSeleccionada.estado)">
          {{ asistenciaSeleccionada.estado | estadoTexto }}
        </span>
      </div>
      <div class="info-row" *ngIf="asistenciaSeleccionada.observaciones">
        <strong>Observaciones:</strong>
        <span>{{ asistenciaSeleccionada.observaciones }}</span>
      </div>
    </div>
    <div class="form-actions">
      <button type="button" class="btn secondary" (click)="cerrarModalDetalle()">âœ–ï¸ Cerrar</button>
    </div>
  </div>
</div>