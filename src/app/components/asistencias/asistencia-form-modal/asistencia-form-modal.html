<div class="modal-overlay" (click)="cerrarModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <!-- T√≠tulo din√°mico seg√∫n modo -->
    <h3>{{ modoEdicion ? '‚úèÔ∏è Editar Asistencia' : '‚ûï Nueva Asistencia' }}</h3>

    <!-- Loader mientras carga usuarios -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="spinner"></div>
      <p>Cargando usuarios...</p>
    </div>

    <!-- üî• FORMULARIO REACTIVO -->
    <form 
      class="asistencia-form" 
      *ngIf="!isLoading" 
      [formGroup]="asistenciaForm" 
      (ngSubmit)="guardarAsistencia()">
      
      <!-- Usuario -->
      <div class="form-group">
        <label>Usuario *</label>
        <select formControlName="usuarioId">
          <option value="">Seleccionar usuario...</option>
          <option *ngFor="let usuario of usuarios" [value]="usuario.uid">
            {{ usuario.nombreCompleto }}
          </option>
        </select>
        <!-- üî• Mensajes de error personalizados -->
        <span class="error-msg" *ngIf="mostrarErrorUsuario()">
          {{ obtenerErrorUsuario() }}
        </span>
      </div>

      <!-- Fecha -->
      <div class="form-group">
        <label>Fecha *</label>
        <input type="date" formControlName="fecha">
        <span class="error-msg" *ngIf="mostrarErrorFecha()">
          {{ obtenerErrorFecha() }}
        </span>
      </div>

      <!-- Hora de Entrada -->
      <div class="form-group">
        <label>Hora de Entrada *</label>
        <input type="time" formControlName="horaEntrada">
        <span class="error-msg" *ngIf="mostrarErrorHoraEntrada()">
          {{ obtenerErrorHoraEntrada() }}
        </span>
      </div>

      <!-- Hora de Salida -->
      <div class="form-group">
        <label>Hora de Salida</label>
        <input type="time" formControlName="horaSalida">
        <span class="error-msg" *ngIf="mostrarErrorHoraSalida()">
          {{ obtenerErrorHoraSalida() }}
        </span>
      </div>

      <!-- Estado -->
      <div class="form-group">
        <label>Estado *</label>
        <select formControlName="estado">
          <option value="presente">Presente</option>
          <option value="ausente">Ausente</option>
          <option value="tardanza">Tardanza</option>
          <option value="permiso">Permiso</option>
        </select>
      </div>

      <!-- Observaciones -->
      <div class="form-group">
        <label>Observaciones</label>
        <textarea 
          formControlName="observaciones"
          rows="3" 
          placeholder="Comentarios adicionales (opcional, m√°ximo 500 caracteres)">
        </textarea>
        <span class="error-msg" *ngIf="mostrarErrorObservaciones()">
          {{ obtenerErrorObservaciones() }}
        </span>
      </div>

      <!-- üî• Indicador visual del estado del formulario (opcional) -->
      <div class="form-status" *ngIf="asistenciaForm.invalid && asistenciaForm.touched">
        <small style="color: #e74c3c;">
          ‚ö†Ô∏è Por favor, corrige los errores antes de guardar
        </small>
      </div>

      <!-- Botones -->
      <div class="form-actions">
        <button 
          type="submit" 
          class="btn primary" 
          [disabled]="isSaving || asistenciaForm.invalid">
          {{ isSaving ? '‚è≥ Guardando...' : (modoEdicion ? 'üíæ Actualizar' : 'üíæ Guardar') }}
        </button>
        <button 
          type="button" 
          class="btn secondary" 
          (click)="cerrarModal()"
          [disabled]="isSaving">
          ‚úñ Cancelar
        </button>
      </div>
    </form>
  </div>
</div>