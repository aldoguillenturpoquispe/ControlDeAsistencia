<section class="admin-stats">
  <!-- Loader -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando estad√≠sticas...</p>
  </div>

  <!-- Contenido -->
  <div *ngIf="!isLoading">
    <h2>Panel de Estad√≠sticas</h2>

    <!-- Filtros de fecha -->
    <div class="filters-stats">
      <label>
        Per√≠odo:
        <select [(ngModel)]="periodo" (change)="actualizarEstadisticas()">
          <option value="hoy">Hoy</option>
          <option value="semana">Esta Semana</option>
          <option value="mes">Este Mes</option>
          <option value="anio">Este A√±o</option>
        </select>
      </label>
      <label>
        Desde:
        <input type="date" [(ngModel)]="fechaDesde">
      </label>
      <label>
        Hasta:
        <input type="date" [(ngModel)]="fechaHasta">
      </label>
      <button class="btn-filter" (click)="actualizarEstadisticas()">üîç Actualizar</button>
    </div>

    <!-- Resumen en tarjetas principales -->
    <div class="cards">
      <div class="card">
        <div class="card-icon">üë•</div>
        <h3>Total Usuarios</h3>
        <p class="value">{{ datosEstadisticas.totalUsuarios }}</p>
        <span class="card-subtitle">Registrados activos</span>
      </div>
      <div class="card">
        <div class="card-icon">‚úÖ</div>
        <h3>Asistencias Hoy</h3>
        <p class="value success">{{ datosEstadisticas.asistenciasHoy }}</p>
        <span class="card-subtitle">Presentes</span>
      </div>
      <div class="card">
        <div class="card-icon">‚ùå</div>
        <h3>Faltas Hoy</h3>
        <p class="value danger">{{ datosEstadisticas.faltasHoy }}</p>
        <span class="card-subtitle">Ausentes</span>
      </div>
      <div class="card">
        <div class="card-icon">üìä</div>
        <h3>Porcentaje Asistencia</h3>
        <p class="value warning">{{ datosEstadisticas.porcentajeAsistencia }}%</p>
        <span class="card-subtitle">Del per√≠odo seleccionado</span>
      </div>
    </div>

    <!-- Tarjetas adicionales de resumen -->
    <div class="cards-secondary">
      <div class="card-small">
        <h4>Tardanzas del Per√≠odo</h4>
        <p class="value-small">{{ datosEstadisticas.tardanzasMes }}</p>
      </div>
      <div class="card-small">
        <h4>Promedio Horas/D√≠a</h4>
        <p class="value-small">{{ datosEstadisticas.promedioHoras }}h</p>
      </div>
      <div class="card-small">
        <h4>D√≠as Laborables</h4>
        <p class="value-small">{{ datosEstadisticas.diasLaborables }}</p>
      </div>
      <div class="card-small">
        <h4>Mejor Asistencia</h4>
        <p class="value-small">{{ datosEstadisticas.mejorAsistencia }}%</p>
      </div>
    </div>

    <!-- Gr√°ficos (COMPONENTE SEPARADO con inputs) -->
    <app-stats-charts 
      [fechaDesde]="fechaDesde" 
      [fechaHasta]="fechaHasta">
    </app-stats-charts>
    
    <!-- Tabla de top usuarios (COMPONENTE SEPARADO con inputs) -->
    <app-stats-top-usuarios 
      [fechaDesde]="fechaDesde" 
      [fechaHasta]="fechaHasta">
    </app-stats-top-usuarios>

    <!-- Resumen por estado (COMPONENTE SEPARADO con inputs) -->
    <app-stats-resumen-estados 
      [fechaDesde]="fechaDesde" 
      [fechaHasta]="fechaHasta">
    </app-stats-resumen-estados>

    <!-- üî• NUEVO: Componente de acciones de exportaci√≥n -->
    <app-stats-export-actions
      [datosEstadisticas]="datosEstadisticas"
      [periodo]="periodo"
      [fechaDesde]="fechaDesde"
      [fechaHasta]="fechaHasta">
    </app-stats-export-actions>
  </div>
</section>